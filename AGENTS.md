# QuitDay-APP 编码代理指导文档 (AGENTS)
## 特别要求
- 热重载可用性：“否”
## 1. 文档目的

## 2. 项目概述


### 2.1 核心功能
- 应用实现平台：‘支持Web和Android平台’
- 功能：‘习惯的添加、编辑、删除和追踪’
- 数据管理：‘数据的导入导出和WebDAV备份’
- 可视化展示：‘习惯坚持时间的可视化展示’
- 详细的习惯数据统计：‘提供详细的习惯数据统计，包括坚持时间、节省金钱和时间等’  

### 2.2 技术栈
- 框架：Flutter 3.0+
- 语言：Dart 3.0+
- 状态管理：Provider
- 路由管理：GoRouter
- 本地存储：SQLite (移动平台) / localStorage (Web平台)
- 数据格式：CSV
- WebDAV客户端：需实现WebDAV协议基本操作，包括上传、下载、删除文件等
### 3.3 开发设备
- **模拟器**：
  - Android：使用Android Studio的AVD Manager创建模拟器
  - iOS：使用Xcode的Simulator
- **真机**：使用实际的Android或iOS设备进行测试

## 4. 代码规范

### 4.1 命名规范
- **文件命名**：使用小写字母和下划线，例如 `habit_provider.dart`
- **类命名**：使用大驼峰命名法，例如 `HabitProvider`
- **方法命名**：使用小驼峰命名法，例如 `loadHabits()`
- **变量命名**：使用小驼峰命名法，例如 `habitList`
- **常量命名**：使用全大写字母和下划线，例如 `MAX_HABITS`
- **参数命名**：使用小驼峰命名法，例如 `habitId`

### 4.2 代码风格
- **缩进**：使用4个空格进行缩进
- **行宽**：每行代码不超过80个字符
- **空行**：
  - 在类的方法之间添加空行
  - 在逻辑块之间添加空行
  - 在文件末尾添加空行
- **注释**：
  - 为类、方法和重要的代码块添加注释
  - 使用文档注释（///）为公共API添加文档
  - 注释应该清晰、简洁，说明代码的用途和逻辑

### 4.3 代码组织
- **文件结构**：按照功能模块组织文件，遵循项目的目录结构
- **类的大小**：单个类的代码量不宜过大，一般不超过500行
- **方法的大小**：单个方法的代码量不宜过大，一般不超过50行
- **代码复用**：尽量复用代码，避免重复实现相同的功能
- **模块化**：将功能拆分为多个模块，提高代码的可维护性

### 4.4 最佳实践
- **使用const构造函数**：对于不变的Widget，使用const构造函数
- **避免不必要的重建**：使用const、constraints等方式避免不必要的Widget重建
- **使用ListView.builder**：对于长列表，使用ListView.builder提高性能
- **使用Provider管理状态**：遵循Provider的最佳实践，合理组织状态管理
- **使用GoRouter管理路由**：遵循GoRouter的最佳实践，合理配置路由
- **错误处理**：添加适当的错误处理，避免应用崩溃
- **日志记录**：添加适当的日志记录，便于调试和问题排查

### 4.5 编码代理特定规范
- **代码分析**：在修改代码前，先分析代码结构和逻辑，理解其功能和依赖关系
- **变更追踪**：记录所有代码变更，确保变更可追踪和可回滚
- **性能分析**：对修改的代码进行性能分析，确保不引入性能问题
- **安全性检查**：检查代码的安全性，避免引入安全漏洞
- **兼容性检查**：确保代码在所有支持的平台上都能正常运行

## 5. 开发流程

### 5.1 需求分析
- 理解产品需求文档（PRD.md）的内容
- 分析技术实现的可行性
- 确定开发的优先级和时间计划

### 5.2 设计阶段
- 参考技术实现文档（TECH_DESIGN.md）的设计
- 设计UI界面和交互流程
- 设计数据结构和存储方案
- 设计API接口和网络请求

### 5.3 编码阶段
- 按照设计文档实现功能
- 遵循代码规范编写代码
- 定期提交代码，保持代码库的更新
- 进行代码自检，确保代码质量

### 5.4 测试阶段
- 进行单元测试，测试核心功能
- 进行集成测试，测试页面交互
- 进行端到端测试，测试完整流程
- 在不同设备和平台上进行测试
- 修复测试中发现的问题

### 5.5 部署阶段
- 构建发布版本
- 进行最终测试
- 部署到目标平台
- 监控应用的运行状态

## 6. 版本控制

### 6.1 分支管理
- **master**：主分支，用于发布稳定版本
- **develop**：开发分支，用于集成开发中的功能
- **feature/**：功能分支，用于开发新功能
- **bugfix/**：修复分支，用于修复bug
- **hotfix/**：紧急修复分支，用于修复生产环境中的紧急bug

### 6.2 分支策略
- 从develop分支创建feature分支
- 完成功能开发后，将feature分支合并回develop分支
- 从master分支创建hotfix分支
- 完成bug修复后，将hotfix分支合并回master和develop分支
- 定期从develop分支合并到master分支，发布新版本

### 6.3 提交规范
- **提交信息**：使用清晰、简洁的提交信息，说明提交的内容和目的
- **提交频率**：定期提交代码，每次提交应该是一个完整的、可测试的变更
- **提交范围**：每次提交的范围不宜过大，应该只包含相关的变更
- **提交格式**：
  ```
  <类型>: <描述>
  
  <详细描述>
  
  <关联的issue或任务>
  ```
- **提交类型**：
  - feat：新功能
  - fix：bug修复
  - docs：文档更新
  - style：代码风格调整
  - refactor：代码重构
  - test：测试代码
  - chore：构建或依赖更新

### 6.4 代码审查
- 所有代码变更都应该经过代码审查
- 代码审查应该关注代码质量、功能实现、安全性和性能
- 代码审查通过后，才能合并到目标分支
- 对于重要的变更，应该进行多人审查

## 7. 测试策略

### 7.1 测试类型
- **单元测试**：测试独立的函数、方法或类
- **集成测试**：测试多个组件或模块的交互
- **端到端测试**：测试完整的用户流程
- **性能测试**：测试应用的性能和响应时间
- **兼容性测试**：测试应用在不同设备和平台上的兼容性

### 7.2 测试工具
- **单元测试**：使用Flutter的测试框架
- **集成测试**：使用Flutter的integration_test包
- **端到端测试**：使用Flutter的integration_test包或第三方工具
- **性能测试**：使用Flutter的performance_viewer或第三方工具

### 7.3 测试覆盖率
- 核心功能的测试覆盖率应该达到80%以上
- 重要的业务逻辑应该有完整的测试
- 定期检查测试覆盖率，确保测试的全面性

### 7.4 测试流程
- 在开发过程中编写测试代码
- 在提交代码前运行测试
- 在合并分支前运行完整的测试套件
- 在发布前进行最终的测试

## 8. 部署流程

### 8.1 Web平台部署
1. **构建Web版本**：
   ```bash
   flutter build web --release
   ```
2. **部署到Web服务器**：
   - 将build/web目录部署到Web服务器（如Nginx、Apache）
   - 配置Web服务器的静态文件服务
3. **容器化部署**：
   - 使用Dockerfile构建Docker镜像
   - 运行Docker容器
   ```bash
   docker build -t quitday-app .
   docker run -p 8080:80 quitday-app
   ```

### 8.2 Android平台部署
1. **构建Android版本**：
   ```bash
   flutter build apk --release
   ```
2. **签名APK**：
   - 使用keystore文件签名APK
   - 配置build.gradle文件中的签名信息
3. **发布到应用商店**：
   - 准备应用商店所需的材料（如截图、描述、图标等）
   - 提交APK到Google Play商店或其他应用商店
4. **分发给用户**：
   - 通过邮件、网站等方式分发给用户
   - 提供安装指南和更新机制

### 8.3 版本管理
- **版本号**：使用语义化版本号（Major.Minor.Patch）
- **版本命名**：为每个版本制定有意义的名称
- **版本记录**：维护版本变更记录，记录每个版本的主要变更

### 8.4 回滚策略
- 为每个版本保留备份
- 制定回滚计划，以便在出现问题时能够快速回滚
- 测试回滚流程，确保回滚能够正常工作

## 9. 团队协作

### 9.1 沟通工具
- **即时通讯**：使用微信、QQ或其他即时通讯工具进行日常沟通
- **项目管理**：使用GitHub Issues或其他项目管理工具管理任务和问题
- **代码审查**：使用GitHub Pull Requests进行代码审查
- **文档协作**：使用GitHub Wiki或其他文档工具进行文档协作

### 9.2 协作流程
- **任务分配**：根据团队成员的专长和工作量分配任务
- **进度跟踪**：定期更新任务的进度，确保项目按时完成
- **问题解决**：及时沟通和解决开发中遇到的问题
- **知识共享**：定期分享开发经验和技术知识

### 9.3 会议制度
- **每日站会**：简短的日常会议，讨论当日的工作和遇到的问题
- **周会**：每周的会议，讨论项目的进展和下周的计划
- **评审会议**：代码审查和设计评审的会议
- **retrospective会议**：项目完成后的回顾会议，总结经验和教训

### 9.4 团队规范
- **工作时间**：遵循团队的工作时间安排
- **代码所有权**：团队共同拥有代码，每个人都有责任维护代码质量
- **尊重他人**：尊重团队成员的意见和贡献
- **积极沟通**：积极参与团队沟通和讨论
- **持续学习**：不断学习新技术和方法，提高自身能力

## 10. 常见问题

### 10.1 开发环境问题
- **Flutter版本不兼容**：确保使用正确的Flutter版本，使用 `flutter upgrade` 或 `flutter downgrade` 切换版本
- **依赖冲突**：运行 `flutter pub get` 解决依赖冲突，或修改pubspec.yaml文件
- **Android SDK问题**：确保安装了正确版本的Android SDK，使用Android Studio的SDK Manager进行管理
- **iOS SDK问题**：确保安装了正确版本的Xcode和iOS SDK

### 10.2 代码问题
- **编译错误**：检查代码语法，确保所有的括号和分号都正确
- **运行时错误**：使用调试工具定位错误，检查日志输出
- **性能问题**：使用性能分析工具分析性能瓶颈，优化代码
- **内存泄漏**：使用内存分析工具检测内存泄漏，及时释放资源

### 10.3 测试问题
- **测试失败**：分析测试失败的原因，修复相关的代码
- **测试覆盖不足**：增加测试用例，提高测试覆盖率
- **测试环境问题**：确保测试环境的配置正确，与生产环境一致

### 10.4 部署问题
- **构建失败**：检查构建配置，确保所有的依赖都正确安装
- **部署失败**：检查部署环境的配置，确保服务器的设置正确
- **应用崩溃**：检查应用的日志，定位崩溃的原因
- **性能问题**：监控应用的运行状态，分析性能瓶颈

## 11. 编码代理指南

### 11.1 代码分析策略
- **静态分析**：使用Flutter的分析工具对代码进行静态分析，识别潜在问题
- **依赖分析**：分析代码的依赖关系，确保修改不会破坏其他功能
- **复杂度分析**：评估代码的复杂度，识别需要重构的部分
- **测试覆盖率分析**：分析测试覆盖率，确保修改的代码有足够的测试覆盖

### 11.2  bug修复流程
1. **问题识别**：准确定位bug的位置和原因
2. **根因分析**：分析bug的根本原因，而不仅仅是表面现象
3. **修复方案**：制定多种修复方案，选择最优方案
4. **实施修复**：按照最佳实践实施修复
5. **测试验证**：运行测试确保bug已修复且未引入新问题
6. **回归测试**：确保修复不会影响其他功能

### 11.3 代码优化策略
- **性能优化**：
  - 减少Widget重建
  - 优化列表渲染
  - 减少不必要的计算
  - 使用适当的缓存策略
- **内存优化**：
  - 及时释放资源
  - 避免内存泄漏
  - 优化对象创建和销毁
- **代码质量优化**：
  - 减少代码重复
  - 提高代码可读性
  - 简化复杂逻辑
  - 遵循设计模式

### 11.4 跨平台兼容性处理
- **平台特定代码**：使用kIsWeb和Platform类处理平台差异
- **文件系统差异**：使用平台特定的文件系统API
- **存储差异**：根据平台选择合适的存储方案
- **UI差异**：根据平台调整UI布局和交互

### 11.5 工具推荐
- **IDE**：Android Studio、Visual Studio Code
- **调试工具**：Flutter DevTools、Chrome DevTools
- **性能分析**：Flutter Performance View、Android Profiler
- **网络工具**：Postman、Insomnia
- **版本控制**：Git、GitHub Desktop
- **项目管理**：GitHub Issues、Jira
- **文档工具**：Markdown、GitHub Wiki

### 11.6 资源链接
- **Flutter官网**：https://flutter.dev/
- **Dart官网**：https://dart.dev/
- **Flutter文档**：https://flutter.dev/docs/
- **Dart文档**：https://dart.dev/guides
- **GitHub**：https://github.com/
- **Stack Overflow**：https://stackoverflow.com/
- **Flutter中文网**：https://flutterchina.club/

### 11.7 代码示例
- **Provider使用示例**：
  ```dart
  class HabitProvider extends ChangeNotifier {
    List<Habit> _habits = [];
    
    List<Habit> get habits => _habits;
    
    Future<void> loadHabits() async {
      // 实现加载习惯的逻辑
      notifyListeners();
    }
  }
  ```

- **GoRouter使用示例**：
  ```dart
  class AppRouter {
    static GoRouter createRouter() {
      return GoRouter(
        routes: [
          GoRoute(
            path: '/',
            builder: (context, state) => const MainScreen(),
            name: 'main',
          ),
          // 其他路由
        ],
      );
    }
  }
  ```

- **Widget构建示例**：
  ```dart
  class HabitCard extends StatelessWidget {
    final Habit habit;
    
    const HabitCard({Key? key, required this.habit}) : super(key: key);
    
    @override
    Widget build(BuildContext context) {
      return Card(
        // 实现卡片的构建逻辑
      );
    }
  }
  ```

### 11.8 术语表
- **Flutter**：Google开发的跨平台UI框架
- **Dart**：Flutter使用的编程语言
- **Provider**：Flutter的状态管理库
- **GoRouter**：Flutter的路由管理库
- **SQLite**：轻量级的关系型数据库
- **localStorage**：Web浏览器的本地存储API
- **WebDAV**：基于HTTP的文件共享协议
- **CSV**：逗号分隔值文件格式
- **Widget**：Flutter的UI构建块
- **State**：Flutter中Widget的状态
- **BuildContext**：Widget在Widget树中的上下文
- **Hot Reload**：Flutter的热重载功能，用于快速查看代码变更
- **Hot Restart**：Flutter的热重启功能，用于重新启动应用
- **Pub**：Dart的包管理器
- **APK**：Android应用的安装包格式
- **IPA**：iOS应用的安装包格式
- **Docker**：容器化平台
- **CI/CD**：持续集成和持续部署